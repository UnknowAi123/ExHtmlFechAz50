<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reproductor de Música HTML</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #controls {
      margin-bottom: 15px;
    }
    button {
      padding: 10px 15px;
      margin: 5px;
      font-size: 16px;
    }
    #playlist {
      list-style: none;
      padding: 0;
    }
    #playlist li {
      padding: 5px;
      cursor: pointer;
    }
    #playlist li.active {
      background-color: #ddd;
    }
  </style>
</head>
<body>
  <h1>Reproductor de Música</h1>
  
  <div id="fileSelection">
    <!-- Permite seleccionar archivos o carpetas -->
    <input type="file" id="fileInput" multiple webkitdirectory accept="audio/*">
  </div>
  
  <div id="controls">
    <button id="prevButton">Anterior</button>
    <button id="playButton">Play</button>
    <button id="pauseButton">Pause</button>
    <button id="nextButton">Siguiente</button>
    <button id="shuffleToggle">Shuffle Off</button>
    <button id="exportPlaylist">Exportar Playlist</button>
  </div>
  
  <ul id="playlist"></ul>
  
  <!-- Elemento de audio (sin controles nativos para personalizar la interfaz) -->
  <audio id="audioPlayer"></audio>
  
  <script>
    // Variables globales
    let playlist = []; // Array de objetos {name, url}
    let currentIndex = 0;
    let shuffleOn = false;
    const audioPlayer = document.getElementById('audioPlayer');
    const fileInput = document.getElementById('fileInput');
    const playlistUI = document.getElementById('playlist');
    const playButton = document.getElementById('playButton');
    const pauseButton = document.getElementById('pauseButton');
    const prevButton = document.getElementById('prevButton');
    const nextButton = document.getElementById('nextButton');
    const shuffleToggle = document.getElementById('shuffleToggle');
    const exportPlaylistButton = document.getElementById('exportPlaylist');
    
    // Función para actualizar la visualización de la lista
    function updatePlaylistUI() {
      playlistUI.innerHTML = '';
      playlist.forEach((item, index) => {
        const li = document.createElement('li');
        li.textContent = item.name;
        li.dataset.index = index;
        if (index === currentIndex) li.classList.add('active');
        li.addEventListener('click', () => {
          currentIndex = index;
          loadCurrentTrack();
          playCurrentTrack();
          updatePlaylistUI();
        });
        playlistUI.appendChild(li);
      });
    }
    
    // Función para cargar el track actual en el reproductor
    function loadCurrentTrack() {
      if(playlist[currentIndex]){
        audioPlayer.src = playlist[currentIndex].url;
      }
    }
    
    // Funciones de control de reproducción
    function playCurrentTrack() {
      audioPlayer.play();
      updatePlaylistUI();
    }
    
    function pauseCurrentTrack() {
      audioPlayer.pause();
    }
    
    function nextTrack() {
      if (shuffleOn) {
        currentIndex = Math.floor(Math.random() * playlist.length);
      } else {
        currentIndex = (currentIndex + 1) % playlist.length;
      }
      loadCurrentTrack();
      playCurrentTrack();
    }
    
    function prevTrack() {
      if (shuffleOn) {
        currentIndex = Math.floor(Math.random() * playlist.length);
      } else {
        currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
      }
      loadCurrentTrack();
      playCurrentTrack();
    }
    
    // Event listeners para los botones de control
    playButton.addEventListener('click', () => {
      if (!audioPlayer.src && playlist.length > 0) {
        loadCurrentTrack();
      }
      playCurrentTrack();
    });
    
    pauseButton.addEventListener('click', pauseCurrentTrack);
    nextButton.addEventListener('click', nextTrack);
    prevButton.addEventListener('click', prevTrack);
    
    shuffleToggle.addEventListener('click', () => {
      shuffleOn = !shuffleOn;
      shuffleToggle.textContent = shuffleOn ? 'Shuffle On' : 'Shuffle Off';
    });
    
    // Exportar lista de reproducción (nombre de archivos, separados por saltos de línea)
    exportPlaylistButton.addEventListener('click', () => {
      if (playlist.length === 0) return;
      const playlistText = playlist.map(item => item.name).join('\n');
      const blob = new Blob([playlistText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'playlist.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });
    
    // Cuando el track termina, avanza al siguiente
    audioPlayer.addEventListener('ended', nextTrack);
    
    // Al seleccionar archivos, se crea la playlist
    fileInput.addEventListener('change', (event) => {
      const files = event.target.files;
      playlist = [];
      // Se recorre la selección y se crean URLs para cada archivo de audio
      Array.from(files).forEach(file => {
        // Opcional: filtrar por extensión o tipo MIME (audio/*)
        const url = URL.createObjectURL(file);
        playlist.push({ name: file.name, url });
      });
      // Orden natural (si shuffle está activado se podría mezclar automáticamente)
      if (shuffleOn) {
        shuffleArray(playlist);
      }
      currentIndex = 0;
      updatePlaylistUI();
      if (playlist.length > 0) {
        loadCurrentTrack();
      }
    });
    
    // Función auxiliar de shuffle (Fisher-Yates)
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
  </script>
</body>
</html>
